<%- include('partials/header') %>

<section class="bg-white py-12">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-10">
      <h1 class="text-3xl font-bold text-gray-800">Browse IoT Products</h1>
      <p class="mt-2 text-gray-500">
        Discover our extensive range of IoT devices and components
      </p>
    </div>

    <form method="GET" action="/devices" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-10">
      <!--  Search -->
      <input
        type="text"
        name="search"
        placeholder="Search by name or brand"
        value="<%= filters.search || '' %>"
        class="px-4 py-2 border rounded-md w-full"
      />
    
      <!--  Catalog Filter -->
      <select name="catalog" class="px-4 py-2 border rounded-md w-full">
        <option value="All">All Categories</option>
        <% catalogOptions.forEach(option => { %>
          <option value="<%= option %>" <%= filters.catalog === option ? 'selected' : '' %>><%= option %></option>
        <% }) %>
      </select>
    
      <!--  Sort Option -->
      <select name="sort" class="px-4 py-2 border rounded-md w-full">
       
        <option value="name-asc" <%= filters.sort === "name-asc" ? "selected" : "" %>>Sort: Name (A-Z)</option>
        <option value="brand-asc" <%= filters.sort === "brand-asc" ? "selected" : "" %>>Sort: Company (A–Z)</option>
        <option value="price-asc" <%= filters.sort === "price-asc" ? "selected" : "" %>>Sort: Price (Low → High)</option>
        <option value="price-desc" <%= filters.sort === "price-desc" ? "selected" : "" %>>Sort: Price (High → Low)</option>
        <option value="stock-desc" <%= filters.sort === "stock-desc" ? "selected" : "" %>>Sort: Stock (High → Low)</option>
      </select>
    
      <!--  Submit -->
      <div>
        <button type="submit" class="bg-blue-600 text-white w-full py-2 px-4 rounded hover:bg-blue-700">
          Apply Filters
        </button>
      </div>
    </form>
    

    <% if (userRole === 'staff') { %>
    <div class="flex justify-end mb-6">
      <a
        href="/devices/new"
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >+ Add New Device</a
      >
    </div>
    <% } %> <% if (devices.length === 0) { %>
    <p class="text-center text-gray-500">No devices found.</p>
    <% } else { %>
    <div
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"
    >
      <% devices.forEach(device => { %>
        <div
                class="bg-white shadow-md rounded-lg overflow-hidden 
                       hover:shadow-xl transition duration-300
                      flex flex-col h-full"
              >
        <% if (device.imageUrl) { %>
        <img
          src="<%= device.imageUrl %>"
          alt="<%= device.name %>"
          class="w-full h-48 object-cover"
        />
        <% } %>
        <div class="p-4 flex-grow">
          <h2 class="text-lg font-semibold text-gray-800">
            <%= device.name %>
          </h2>
          <p class="text-sm text-gray-500 mb-2"><%= device.brand %></p>
          <p class="text-sm text-gray-500 mb-2"><%= device.catalog %></p>
          <p class="text-sm text-gray-600 mb-4"><%= device.description %></p>
          <div class="flex justify-between items-center">
            <span class="text-blue-600 font-bold"
              >$<%= device.price.toFixed(2) %></span
            >
            <% if (device.stock > 0) { %>
            <span class="text-sm text-green-600">In Stock</span>
            <% } else { %>
            <span class="text-sm text-red-500">Out of Stock</span>
            <% } %>
          </div>
        </div>
        <div class="bg-gray-100 px-4 py-3 flex justify-between items-center">
          <button
  onclick="window.location.href='/product/<%= device.id %>'"
  class="bg-blue-600 text-white text-sm px-3 py-1 rounded hover:bg-blue-700 transition"
>
  View Details
</button>

        
          <% if (userRole === 'staff') { %>
            <div class="flex gap-2">
              <!-- Edit Button -->
              <a href="/devices/edit/<%= device.id %>" class="bg-yellow-500 text-white text-xs px-3 py-1 rounded hover:bg-yellow-600">
                Edit
              </a>
        
              <!-- Delete Button -->
              <form action="/devices/delete/<%= device.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this device?');">
                <button type="submit" class="bg-red-600 text-white text-xs px-3 py-1 rounded hover:bg-red-700">
                  Delete
                </button>
              </form>
            </div>
          <% } %>
        </div>
        

        <!-- Inline Details Section -->
        <div
          id="device-<%= device.id %>"
          class="hidden bg-gray-50 px-4 py-4 text-sm text-gray-700"
        >
          <hr class="mb-3" />
          <p><strong>Description:</strong> <%= device.description %></p>
          <p><strong>Brand:</strong> <%= device.brand %></p>
          <p><strong>Catalog:</strong> <%= device.catalog %></p>
          <p><strong>Price:</strong> $<%= device.price.toFixed(2) %></p>
          <p><strong>Stock:</strong> <%= device.stock %> unit(s)</p>
        </div>
      </div>
      <% }) %>
    </div>
    <% } %>
  </div>
</section>
<script>
  function toggleDetails(id, btn) {
    const box = document.getElementById(id);
    const isHidden = box.classList.contains("hidden");
    box.classList.toggle("hidden");

    // Change button text
    if (btn) {
      btn.textContent = isHidden ? "Hide Details" : "View Details";
    }
  }
</script>

<%- include('partials/footer') %>

<%- include('partials/header') %>

<section class="min-h-screen bg-gray-100 py-8 px-4">
  <div class="max-w-4xl mx-auto bg-white shadow-md rounded-lg p-6">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">
      Edit Order #<%= order.id %>
    </h2>

    <% if (order.status !== "Placed") { %>
    <div
      class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6"
      role="alert"
    >
      <p>
        This order cannot be edited because its status is <%= order.status %>.
      </p>
    </div>
    <% } else { %>
    <form
      action="/orders/update/<%= order.id %><%= locals.anonymousId ? '?anonymousId=' + anonymousId : '' %>"
      method="POST"
    >
      <div class="overflow-hidden shadow sm:rounded-md">
        <div class="px-4 py-5 bg-white sm:p-6">
          <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">
            Order Items
          </h3>

          <div class="space-y-6">
            <% order.OrderItems.forEach((item, index) => { %>
            <div class="border border-gray-200 rounded-md p-4 bg-gray-50">
              <div class="flex flex-wrap md:flex-nowrap gap-4 items-center">
                <div class="w-full md:w-6/12">
                  <p class="font-medium"><%= item.Device.name %></p>
                  <p class="text-sm text-gray-500">
                    <%= item.Device.brand %> Â· <%= item.Device.catalog %>
                  </p>
                  <p class="text-sm">
                    <span class="font-medium">Price:</span> $<%=
                    item.price.toFixed(2) %>
                  </p>
                </div>

                <div class="w-full md:w-4/12">
                  <label
                    for="quantity-<%= item.id %>"
                    class="block text-sm font-medium text-gray-700"
                    >Quantity</label
                  >
                  <div class="mt-1 flex rounded-md shadow-sm">
                    <input
                      type="number"
                      name="orderItems[<%= index %>][quantity]"
                      id="quantity-<%= item.id %>"
                      min="1"
                      max="<%= item.Device.stock + item.quantity %>"
                      value="<%= item.quantity %>"
                      class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-md sm:text-sm border-gray-300"
                    />
                    <input
                      type="hidden"
                      name="orderItems[<%= index %>][id]"
                      value="<%= item.id %>"
                    />
                  </div>
                  <p class="mt-1 text-xs text-gray-500">
                    Available: <%= item.Device.stock + item.quantity %>
                  </p>
                </div>

                <div class="w-full md:w-2/12 text-right">
                  <p class="font-medium">
                    $<%= (item.price * item.quantity).toFixed(2) %>
                  </p>
                </div>
              </div>
            </div>
            <% }); %>
          </div>
        </div>

        <div
          class="px-4 py-3 bg-gray-50 text-right sm:px-6 flex justify-between"
        >
          <a
            href="<%= locals.anonymousId ? '/orders/view/' + order.id + '?anonymousId=' + anonymousId : '/orders' %>"
            class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
          >
            Cancel
          </a>
          <button
            type="submit"
            class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
          >
            Update Order
          </button>
        </div>
      </div>
    </form>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>

<%- include('partials/header') %>

<section class="min-h-screen bg-gray-100 py-8">
  <div class="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">My Orders</h2>

    <% if (orders.length === 0) { %>
    <p class="text-center text-gray-500">You have no orders yet.</p>
    <% } else { %>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white">
        <thead>
          <tr
            class="bg-gray-100 text-left text-gray-600 uppercase text-sm leading-normal"
          >
            <th class="py-3 px-6">Device</th>
            <th class="py-3 px-6">Quantity</th>
            <th class="py-3 px-6">Status</th>
            <th class="py-3 px-6">Created At</th>
            <th class="py-3 px-6 text-center">Actions</th>
          </tr>
        </thead>
        <tbody class="text-gray-600 text-sm font-light">
          <% orders.forEach(order => { %>
          <tr class="border-b border-gray-200 hover:bg-gray-100">
            <!-- Link to view order details -->
            <td class="py-3 px-6 whitespace-nowrap">
              <a
                href="/orders/view/<%= order.id %>"
                class="text-blue-600 hover:underline"
              >
                <%= order.Device ? order.Device.name : 'Unknown Device' %>
              </a>
            </td>

            <td class="py-3 px-6"><%= order.quantity %></td>

            <td class="py-3 px-6">
              <span
                class="px-2 py-1 rounded-full text-xs <%= order.status === 'Placed' ? 'bg-green-100 text-green-700' : order.status === 'Cancelled' ? 'bg-red-100 text-red-700' : 'bg-gray-200 text-gray-600' %>"
              >
                <%= order.status %>
              </span>
            </td>

            <td class="py-3 px-6">
              <%= new Date(order.createdAt).toLocaleString() %>
            </td>

            <td class="py-3 px-6 text-center">
              <% if (order.status === 'Placed') { %>
              <div class="flex flex-col sm:flex-row justify-center gap-2">
                <!-- Cancel Button -->
                <form
                  action="/orders/cancel/<%= order.id %>"
                  method="POST"
                  onsubmit="return confirm('Are you sure you want to cancel this order?');"
                >
                  <button
                    type="submit"
                    class="bg-red-500 text-white text-xs px-3 py-1 rounded hover:bg-red-600"
                  >
                    Cancel
                  </button>
                </form>

                <!-- Update Quantity Form -->
                <form
                  action="/orders/update/<%= order.id %>"
                  method="POST"
                  class="flex items-center gap-1"
                >
                  <input
                    type="number"
                    name="quantity"
                    min="1"
                    value="<%= order.quantity %>"
                    class="border w-16 text-center text-xs rounded py-1"
                  />
                  <button
                    type="submit"
                    class="bg-blue-500 text-white text-xs px-3 py-1 rounded hover:bg-blue-600"
                  >
                    Update
                  </button>
                </form>
              </div>
              <% } else { %>
              <span class="text-gray-400 text-xs">No actions</span>
              <% } %>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>

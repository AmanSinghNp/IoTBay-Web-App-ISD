<%- include('partials/header') -%>

<div class="container mx-auto mt-10 p-6 bg-white shadow-md rounded-lg">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">
        <%= payment && payment.id ? 'Update' : 'Add' %> Payment Details for Order #<%= orderId %>
    </h1>

    <% if (errors && errors.length > 0) { %>
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
            <strong class="font-bold">Error!</strong>
            <ul>
                <% errors.forEach(function(error) { %>
                    <li><%= typeof error === 'object' ? error.msg : error %></li>
                <% }); %>
            </ul>
        </div>
    <% } %>
    <% if (success && success.length > 0) { %>
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
            <strong class="font-bold">Success!</strong>
            <p><%= success %></p>
        </div>
    <% } %>

    <form action="<%= payment && payment.id ? '/payment/' + payment.id + '/update' : '/orders/' + orderId + '/payment' %>" method="POST" class="space-y-6">
        <% if (payment && payment.id) { %>
            <input type="hidden" name="order_id" value="<%= orderId %>">
        <% } %>
        <div>
            <label for="payment_method" class="block text-sm font-medium text-gray-700">Payment Method:</label>
            <select id="payment_method" name="payment_method" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                <option value="Credit Card" <%= (payment && payment.payment_method === 'Credit Card') ? 'selected' : '' %>>Credit Card</option>
                <option value="PayPal" <%= (payment && payment.payment_method === 'PayPal') ? 'selected' : '' %>>PayPal</option>
                <option value="Bank Transfer" <%= (payment && payment.payment_method === 'Bank Transfer') ? 'selected' : '' %>>Bank Transfer</option>
            </select>
        </div>

        <div>
            <label for="card_number" class="block text-sm font-medium text-gray-700">Card Number:</label>
            <input type="text" id="card_number" name="card_number" value="<%= (payment && payment.card_number) ? payment.card_number : '' %>" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="expiry_date" class="block text-sm font-medium text-gray-700">Expiry Date (MM/YY):</label>
                <input type="text" id="expiry_date" name="expiry_date" value="<%= (payment && payment.expiry_date) ? payment.expiry_date : '' %>" placeholder="MM/YY" required pattern="^(0[1-9]|1[0-2])\/?([0-9]{2})$" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <div>
                <label for="cvv" class="block text-sm font-medium text-gray-700">CVV:</label>
                <input type="text" id="cvv" name="cvv" value="<%= (payment && payment.cvv) ? payment.cvv : '' %>" required pattern="^[0-9]{3,4}$" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
        </div>
        
        <div>
            <label for="amount" class="block text-sm font-medium text-gray-700">Amount:</label>
            <input type="number" id="amount" name="amount" value="<%= (payment && payment.amount) ? payment.amount : '' %>" step="0.01" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
        </div>

        <div>
            <label for="payment_date" class="block text-sm font-medium text-gray-700">Payment Date:</label>
            <input type="date" id="payment_date" name="payment_date" value="<%= (payment && payment.payment_date) ? new Date(payment.payment_date).toISOString().split('T')[0] : new Date().toISOString().split('T')[0] %>" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
        </div>

        <div class="flex justify-end space-x-4">
            <% if (payment && payment.id) { %> 
                <a href="/orders/<%= orderId %>/payment/details" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Cancel</a>
            <% } else { %>
                 <a href="/orders/<%= orderId %>" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Cancel & Back to Order</a>
            <% } %>
            <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <%= payment && payment.id ? 'Update' : 'Save' %> Payment
            </button>
        </div>
    </form>
</div>

<%- include('partials/footer') -%> 
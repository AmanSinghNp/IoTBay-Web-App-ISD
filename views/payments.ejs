<%- include('partials/header') %>

<section class="min-h-screen bg-gray-100 py-8 px-4">
  <div class="max-w-6xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">
      My Payments
    </h2>

    <!-- 🔍 Search Form -->
    <form method="GET" action="/payments" class="flex gap-4 mb-6 flex-wrap">
      <input
        type="text"
        name="paymentId"
        placeholder="Payment ID"
        class="px-4 py-2 border rounded-md"
      />
      <input type="date" name="date" class="px-4 py-2 border rounded-md" />
      <button
        type="submit"
        class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700"
      >
        Search
      </button>
    </form>

    <% if (payments.length === 0) { %>
    <p class="text-center text-gray-500">No payment records found.</p>
    <% } else { %>
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white text-sm">
        <thead>
          <tr class="bg-gray-100 text-left text-gray-600 uppercase">
            <th class="py-3 px-6">Payment ID</th>
            <th class="py-3 px-6">Order</th>
            <th class="py-3 px-6">Device</th>
            <th class="py-3 px-6">Method</th>
            <th class="py-3 px-6">Amount</th>
            <th class="py-3 px-6">Status</th>
            <th class="py-3 px-6">Date</th>
            <th class="py-3 px-6 text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% payments.forEach(payment => { %>
          <tr class="border-b hover:bg-gray-50">
            <td class="py-2 px-4"><%= payment.id %></td>
            <td class="py-2 px-4">#<%= payment.Order?.id %></td>
            <td class="py-2 px-4">
              <%= payment.Order?.Device?.name || 'N/A' %>
            </td>
            <td class="py-2 px-4"><%= payment.paymentMethod %></td>
            <td class="py-2 px-4">$<%= payment.amount.toFixed(2) %></td>
            <td class="py-2 px-4">
              <span
                class="px-2 py-1 rounded-full text-xs <%= payment.status === 'Pending' ? 'bg-yellow-100 text-yellow-700' : payment.status === 'Completed' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700' %>"
              >
                <%= payment.status %>
              </span>
            </td>
            <td class="py-2 px-4">
              <%= new Date(payment.createdAt).toLocaleString() %>
            </td>
            <td class="py-2 px-4 text-center">
              <% if (payment.status === 'Pending') { %>
              <div class="flex gap-2 justify-center">
                <a
                  href="/payments/edit/<%= payment.id %>"
                  class="text-blue-600 hover:underline text-xs"
                  >Edit</a
                >
                <form
                  action="/payments/delete/<%= payment.id %>"
                  method="POST"
                  onsubmit="return confirm('Are you sure you want to delete this payment?');"
                >
                  <button
                    type="submit"
                    class="text-red-600 hover:underline text-xs"
                  >
                    Delete
                  </button>
                </form>
              </div>
              <% } else { %>
              <span class="text-gray-400 text-xs">No actions</span>
              <% } %>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>
